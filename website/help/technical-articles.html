<div class="main">
  <h1 id="top">Technical Articles</h1>

  <div class="toc" >
    <ul class="list">
      <li><a href="#Creating_a_Consistent_User_Experience">Creating a consistent user experience</a></li>
      <li><a href="#How_to_Translate_.60OsmAnd.60_-_We_Need_Your_Assistance.21">How to translate OsmAnd - we need your assistance!</a></li>
      <li><a href="#What_Languages">What languages will be included in OsmAnd ?</a></li>
      <li><a href="#Documentation_of_.60OsmAnd.60_Settings_Development">Documentation of OsmAnd settings development</a></li>
      <li class="toclevel-2"><a href="#Voice_Routing_-_Current_Status_.28by_Hardy.29">Voice Routing - Current Status (by Hardy)</a></li>
      <li class="toclevel-2"><a href="#BackgroundRecording">Background Track Recording - Strategies and Known Issues</a></li>
      <li class="toclevel-2"><a href="#Creating a New TTS Voice Language">Creating a New TTS Voice Language</a></li>
      <li class="toclevel-2"><a href="#Installation_of_Different_Builds">Installation of different builds</a></li>
      <li><a href="#Create_offline_maps_for_yourself">Create offline maps for yourself</a></li>
      <li><a href="#Country_Polygon_Creation">Creating a country polygon</a></li>
      <li><a href="#OsmAnd_Data_Structure">OsmAnd data structure</a></li>
      <li><a href="#How_To_Inspect_an_obf_Binary_File">How to inspect an obf binary file</a></li>
      <li><a href="#OBF_routing_debugging_on_a_PC_with_OSM_map_display">OBF routing debugging on a PC with OSM map display</a></li>
      <li><a href="#Using_KML_Files">Using KML files</a></li>
      <li><a href="#How_to_produce_customized_vector_data">How to produce customized vector data</a></li>
      <li><a href="#OsmAnd_SQLite_Spec">Specification of OsmAnd's SQLite format</a></li>
      <li><a href="#OsmAnd_Metainfo_Spec">Specification of OsmAnd's Metainfo format</a></li>
    </ul>
  </div>

  <div class="question">
    <div class="subtitle" id="Creating_a_Consistent_User_Experience">Creating a consistent user experience</div>
    <div class="content">
      <p>Usability of our complex features is decisively enhanced by wording and good translations, and as much consistency as possible. It is worth thinking about many expressions or sentences for a little while :-)</p>
      <p>Please try to adhere to the following points and conventions:</p>
      <p><b>(1) Consistent Wording:</b></p>
      <p>Use only _one_ expression for a certain feature, do not mix two possible expressions. Examples:</p>
      <ul class="list">
        <li> check for existing expressions and re-use them in new strings, also in translations,of course </li>
        <li> use &#34;navigation&#34;, not &#34;routing&#34;, throughout. </li>
        <li> use &#34;tracking&#34;, not &#34;monitoring&#34; </li>
        <li> understand that &#34;position&#34; is where you are, while &#34;location&#34; refers to arbitrary points </li>
        <li> use &#34;destination&#34;, not &#34;target&#34; </li>
        <li> use &#34;speed&#34;, not &#34;velocity&#34; </li>
        <li> know the difference between &#34;elevation&#34; and &#34;altitude&#34; </li>
        <li> It is &#34;OsmAnd&#34; now, not &#34;Osmand&#34; any more :-) </li>
      </ul>
      <p><b>(2) Authoring Text:</b></p>
      <ul class="list">
        <li> Moreover, please try to re-use existing string constants as much as possible, it is good for memory and performance  :-)
        <li> When changing existing strings, please double-check with _all_ their occurrences in the code
        <li> In general, please be short and precise. EVERY word you write should convey _necessary_ information, so be as precise and as short as possible. Unnecessary text clutters screens without helping much.
        <li> Please double-check appearance of wording in the app, in particular in low-density devices. Too many line breaks, cut-off text or blown-up menu buttons may make a screen almost unusable.
        <li> In some cases there are conventions, which may be worth checking, rather than &#34;inventing something&#34;... So if 99% of commercial navigation systems in your language announce &#34;you have reached your destination&#34;, then using &#34;you have arrived at where you wanted to go&#34; may not be the best of choices ...  :-)
        <li> Clearly mark all features which require Internet access with the expression &#34;online&#34;
      </ul>
      <p><b>(3)</b> A note about rendering: The appearance our default renderer creates has been tested at a multitude of map locations, with many devices, and under very different light conditions. &#34;Spontaneous improvements&#34; to the renderer are almost always questionable, may at least require more investigation and testing than you may think ... :-)</p>
      <p class="back_to_top"><a href="#top">Back to top</a></p>
    </div>
  </div>

  <div class="question">
    <div class="subtitle" id="How_to_Translate_.60OsmAnd.60_-_We_Need_Your_Assistance.21">How to translate OsmAnd - we need your assistance!</div>
    <div class="content">
      <p>We very much appreciate your help providing translations for OsmAnd! Provideing translations is not very complicated, the preferred way to provide string transaltions is described here: <a href="https://hosted.weblate.org/projects/osmand/">OsmAnd @ Hosted Weblate</a>.</p>
      <div class="blocksubtitle">Additional Information</div>
      <ul class="list">
        <li> All translated strings are stored in  <a href="https://github.com/osmandapp/Osmand/tree/master/OsmAnd/res">resources</a>, where you can check if there is already a &#39;values-{language}&#39; directory for your language, e.g. &#39;values-sk&#39; for Slovak.
        <li> Existing language files could be modified by editing the respective strings.xml file (requires a github account) as desired, but please use the easier way of prividing translations and corrections as described above. The master string data is kept in the <a href="https://github.com/osmandapp/Osmand/blob/master/OsmAnd/res/values/strings.xml">english strings.xml file</a>, please do also check out the hints I have added to the beginning of that file.
        <li> To create a translation for a new OsmAnd language, download the <a href="https://github.com/osmandapp/Osmand/blob/master/OsmAnd/res/values/strings.xml">english strings.xml file</a>, translate it  and open an Issue at <a href="https://github.com/osmandapp/Osmand/issues">Github</a></a> (requires an account) announcing that a translation has been created
        <li> The same applies to theswing_messages_{language}.properties files in <a href="https://github.com/osmandapp/Osmand/tree/master/DataExtractionOSM/src/net/osmand/swing">DataExtractionOsm</a> project if you want to translate the map data extractor
      </ul>
      <p>Please use these described methods rather than publishing changes to strings.xml as issues or e-mailing them to the OsmAnd group.</p>
      <p>Thank you for your help !</p>
      <div class="blocksubtitle">Q&#38;A</div>
      <p>Q: Which strings should I translate?*</p>
      <p>A: In the strings.xml the strings look like:
      <pre>
        <string name="shared_string_save_as_gpx">Save as GPX track</string>
      </pre>
      Translate only the <i>&#39;Save route as GPX track&#39;</i> part. In the swing_messages.properties the strings looks like: 
      <pre>IndexCreator.INDEX_CITIES=Indexing cities...</pre>
      Translate only the right part <i>&#39;Indexing cities...&#39;</i></p>
      <br/>
      <p>Q: I don&#39;t want to create github or googlecode account, can I still post you the file?*</p>
      <p>A: Yes, you can email the file, but still for us is the best way to use the github, it is easy.</p>
      <br/>
      <p>Q: How should I check what has changed in the _english strings.xml_ ?*
      <p>
      <p>A: New strings are added always on the top of the file. You can download the english file, your file and use some utility like pspad, or vim, or whatever you like to compare them for the new keys. You can also *<a href="https://github.com/osmandapp/Osmand/blame/master/OsmAnd/res/values/strings.xml">blame</a>* the english file to see the last line modifications.</p>
      <p class="back_to_top"><a href="#top">Back to top</a></p>
    </div>
  </div>

  <div class="question">
    <div class="subtitle" id="What_Languages">What languages will be included in OsmAnd ?</div>
    <div class="content">
	<blockquote>Dear translators,
<p>
<p>Thank you all very much for your efforts to complete our display language translations, and also to localize OsmAnd in more and more languages on <a href="https://hosted.weblate.org/projects/osmand/">Weblate</a>!
<p>
<p>Please note the following: I am happy to include in OsmAnd&#39;s display language selection menu any new language with >10% translation rate, (will mark it as "incomplete" until it reaches ~80%). Please post an issue with OsmAnd if you need this done, I only sporadically watch these figures on Weblate.
<p>
<div>Unfortunately, languages featuring 3-letter ISO 639-2 codes currently seem to have issues in Android, see e.g. 
<li> <a href="https://code.google.com/p/android/issues/detail?id=49120">https://code.google.com/p/android/issues/detail?id=49120</a>
<li> <a href="https://code.google.com/p/android/issues/detail?id=106574">https://code.google.com/p/android/issues/detail?id=106574</a>
<br>This means that, unfortunately, any such language may not display in the OsmAnd menus on your device. (This issue only affects the language used in the app menus, not in the map, of course.)
</div>
<p>
<p>Thanks,
<br>Dr. Hardy Mueller
	</bockquote>
<p>
      <p class="back_to_top"><a href="#top">Back to top</a></p>
    </div>
  </div>

  <div class="question">
    <div class="subtitle" id="Documentation_of_.60OsmAnd.60_Settings_Development">Documentation of OsmAnd Settings Development</div>
    <div class="content">
        <p>This requires a complete rewrite.</p>
        <p class="back_to_top"><a href="#top">Back to top</a></p>
    </div>
  </div>

 
  <div class="question">
    <div class="subtitle" id="Voice_Routing_-_Current_Status_.28by_Hardy.29">Voice Routing - Current Status (by Hardy)</div>
    <div class="content">
      <p>The current feature set is documented in each (new, v1.5-style) tts-config.p file in this comment block in the file header:</p>
      <pre>
% IMPLEMENTED (X) or MISSING ( ) FEATURES, (N/A) if not needed in this language:
%
% (X) Basic navigation prompts: route (re)calculated (with distance and time support), turns, roundabouts, u-turns, straight/follow, arrival
% (X) Announce nearby point names (destination / intermediate / GPX waypoint / favorites / POI)
% (X) Attention prompts: SPEED_CAMERA; SPEED_LIMIT; BORDER_CONTROL; RAILWAY; TRAFFIC_CALMING; TOLL_BOOTH; STOP; PEDESTRIAN; MAXIMUM
% (X) Other prompts: gps lost, off route, back to route
% (X) Street name and prepositions (onto / on / to) and street destination (toward) support
% (X) Distance unit support (meters / feet / yard)
% (N/A) Special grammar: (please specify which)
      </pre>
      <p>The file&#39;s string contents are sorted accordingly, in this fashion we can easily check which file already supports which feature.</p>
      <div class="blocksubtitle">Prompts</div>
      <p>Let me quickly document here which prompt is played when in our voice router module:</p>
      <ol class="list">
        <li><b>&#34;Route recalculated&#34;:</b></li>
        <ol type="a">
          <li> Is played after the route has been recalculated, but only if the new route &#34;is useful&#34;, i.e. now guides you in &#34;forward direction&#34;</li>
          <li> Is suppressed entirely for GPX routing (as it makes no sense then)</li>
        </ol>
        <li>
          <b>&#34;GPS signal lost&#34;:</b>
          <p>Is played after GPS signal has been lost for continuous 20 sec and this was not caused by user action (still buggy, see Issue 893) </p>
        </li>
        <li>
          <b>&#34;Make a U-turn when possible&#34;:</b>
          <p>This prompt is an interim advice for cases where you continuously head in the wrong direction, and does only sound (once) if a new route in forward direction could not be found in x (currently 10) seconds:</p>
          <ol type="a">
            <li> When you head down a long dead end road, where the only possible route out is &#39;backwards&#39;.</li>
            <li> Where a new route in forward direction could not yet be re-calculated within the x seconds.</li>
            <li> The prompt is only played once, until the situation is resolved, i.e. you have either turned in the right direction, or route has been recalculated in &#34;forward&#34; direction.</li>
          </ol>
        </li>
        <li>
          <b>Turn instructions:</b>
          <p> Are suppressed if traveling in a weird directions (account for GPS issues)</p>
        </li>
        <li>
			<b>Lead distances (lead time):</b></li>
			<table style="width:100%">
				<tr>
					<th colspan="2"><b>1. CAR profile</b> (DEFAULT_SPEED = 12m/s=43km/h):</th>
				</tr>
				<tr>
					<td> (a) &#62;3000m out</td>
					<td> &#34;Follow the course of the road for...&#34;</td>
				</tr>
				<tr>
					<td> (b) 3000m-2000m</td>
					<td> PREPARE_LONG</td>
				</tr>
				<tr>
					<td> (c) 1500m-1200m</td>
					<td> PREPARE</td>
				</tr>
				<tr>
					<td> (d) 300m-168m (or &#60;25sec)</td>
					<td> TURN_IN</td>
				</tr>
				<tr>
					<td> (e) &#60;60m (or &#60;5sec)</td>
					<td> TURN</td>
				</tr>
				<tr>
					<th colspan="2"><b>2. BICYCLE profile</b> (DEFAULT_SPEED = 5m/s=18 km/h):</th>
				</tr>
				<tr>
					<td> (b) 500m-300m</td>
					<td> PREPARE_LONG</td>
				</tr>
				<tr>
					<td> (c) ~~500m-350m~~ 200m-120m</td>
					<td> PREPARE</td>
				</tr>
				<tr>
					<td> (d) ~~225m-80m (or &#60;45sec)~~ 80m-60m (or &#60;16sec)</td>
					<td> TURN_IN</td>
				</tr>
				<tr>
					<td> (e) ~~&#60;45m (or &#60;9sec)~~ &#60;30m (or &#60;6sec)</td>
					<td> TURN</td>
				</tr>
				<tr>
					<th colspan="2"><b>3. PEDESTRIAN profile</b> (DEFAULT_SPEED = 2 m/s=7.2km/h):</th>
				</tr>
				<tr>
					<td> (c) ~~200m-150m~~ 100m-70m</td>
					<td> PREPARE</td>
				</tr>
				<tr>
					<td> (d) ~~100m-70m (or &#60;50sec)~~ 50m-30m (or &#60;25sec)</td>
					<td> TURN_IN</td>
				</tr>
				<tr>
					<td> (e) ~~25m or (or &#60;12sec)~~  15m (or &#60;7.5sec)</td>
					<td> TURN</td>
				</tr>
			</table>
			<p>(Corrected values for bike and ped from forum feedback June 2013.)</p>
			<p class="back_to_top"><a href="#top">Back to top</a></p>
    </div>
  </div>

<div class="question">
	<div class="subtitle" id="BackgroundRecording">Background Track Recording - Strategies and Known Issues</div>
	<div class="content">

	<p>This article addresses our GPS track recording. 'Background' means to refer to the OsmAnd app not being displayed in the foreground, in particular when the device screen is off.</p>

	<p>The following issues have been observed over time in different Android versions:</p>

	<p><b>(A) The system may kill background apps to save power:</b></p>

	<p>
	Starting with Android 4.4 (or maybe before), new Android power saving options limit CPU max speed, screen brightness, and may kill running apps. Mitigations:
		<ul class="list">
			<li> (A1) For outdoor use (screen brightness), map rendering (CPU limit), and 'background' track recording I like none of these power saving features and usually turn the device (Android) power saving to entirely off.</li>
			<li> (A2) On some systems it may be sufficient to just exempt the OsmAnd app from power optimization, your mileage may vary. (Issue #5255)</li>
			<li> (A3) Android 8 introduced a new Foreground service in connection with a system notification. Ever since OsmAnd v3.2 we use this foreground service which should also solve the issue, but only for Android 8+. (Issues #5255, #5587)</li>
		</ul>
	</p>

	<p><b>(B) GPS Wake-up Strategy:</b></p>
	<p>
		<ul class="list">
			<li> (B1) While OsmAnd is used for e.g. Navigation: We keep the system's GPS module on all the time, as continuous location information is key here. Effect on battery use (order of magnitude) seems about 5% per hour on older systems up to Android 4.4, 2-3% for newer systems.</li>
			<li> (B2) For 'background' track recording without concurrent navigation: For recording intervals up to 15sec, we also keep the GPS on, no big battery saving can be achieved by other strategies.</li>
			<li> (B3) For intervals >=30sec, we turn GPS on only for each sampling point. This has some noticeable effect on the accuracy of the points recorded, but reduces battery usage to order-of-magnitude 1.2% per hour for 30sec track recording.</li>
		</ul>
	</p>

	<p><b>(C) GPS Wake-up Issues</b></p>

	<p>In order to achieve the GPS wake-up, so far we use the Android AlarmManger to wake up the device periodically (also from Doze mode, which was introduced in Android 6). New Android versions introduced the following issues:
		<ul class="list">
			<li><b> (C1) AlarmManager's setRepeating() became inexact starting with Android 4.4:</b>
				<p>Mitigation: We now use setRepeating() only up to Android 4.2, the new setExact() method starting with Android 4.4, and setExactAndAllowWhileIdle() for Android 8+. (Issue #5632)</p>
			</li>
			<li><b> (C2) Starting from Android 4.4, systems limit the number of times setExact() is executed repeatedly</b> to e.g. once per 5 or even 15 minutes. (The actual value seems wildly device specific.)
				<p>No good solution found for now. Current mitigation is we do not use AlarmManager wake-up, instead keep GPS always on for background track logging on devices with Android 5+ for all recording intervals shorter than 5 minutes. This produces reliable and precise tracks at the cost of the higher battery use. (Issue #5632)</p>
			</li>
		</ul>
	<p>

		<p class="back_to_top"><a href="#top">Back to top</a></p>
	</div>
</div>

  <div class="question">
    <div class="subtitle" id="Creating a New TTS Voice Language">Creating a New TTS Voice Language</div>

     <div class="content">
     <p>Some hints:</p>
      <ul class="list">
        <li> The pronunciation of the voice prompts <u>depends on the TTS engine you use on your device</u> and its settings (outside OsmAnd), most prominently set it to the same language you intend to use for the OsmAnd voice guidance to avoid bad pronunciation effects. See also our FAQ article <a href="http://osmand.net/help-online/faq#tts_not_working">TTS does not funtion properly</a></li>
        <li> OsmAnd only provides the wording, word order, grammar in temrs of declinations, cases, singular/plural, etc.</li>
        <li> This is done in a single voice definition file per language, and now in js (migrated from former PROLOG to make it more mainstream).</li>
        <li> The file name is xx_tts.js, located in your OsmAnd-data-folder/voice/voice/xx-tts, where xx is the respective ISO language_region code.</li>
        <li> You can test your own tts file (or your improvements to existing ones) yourself locally, prior to a pull request, see my comment at <a href="https://github.com/osmandapp/Osmand/issues/6159#issuecomment-432028892">https://github.com/osmandapp/Osmand/issues/6159#issuecomment-432028892</a></li>
        <li> When generating a new language, it makes sense to start from, or at least look at, existing language files from languages with similar structure or grammar, it will greatly simplify to see how things are already solved.</li>
        <li> In order to generate a starting point for contributors, I had once provided some rudimentary language files simply based on dictionary translations and with little specific grammar considerations. When you come across a 'strange one', its probably one of them. :)</li>
      </ul>
      <p class="back_to_top"><a href="#top">Back to top</a></p>
    </div>
  </div>

  <div class="question">
    <div class="subtitle" id="Installation_of_Different_Builds">Installation of different builds</div>
    <div class="content">
      <p>Different builds of OsmAnd should install over any other build of the same strain (older or newer) without any issues, and with all Offline data being preserved.</p>
      <p>The latest development build (not necessarily stable !) for testing can be found <a href="https://download.osmand.net/latest-night-build/OsmAnd-default.apk">here</a>.</p>
      <p>This will update over any more recent existing development build with no problems at all. Should trying to update produce a signing or &#34;not installed&#34; error (like if you currently use the market or a very old dev build), please</p>
      <ul class="list">
        <li> export your Favorites first (Menu/Export in the fav list)</li>
        <li> uninstall the previous version</li>
        <li> re-install the new development build</li>
        <li> re-import your Favorites again (Menu/Import)</li>
      </ul>
      <p>All maps/tracks etc. are kept in place unchanged during this procedure.</p>
      <p class="back_to_top"><a href="#top">Back to top</a></p>
    </div>
  </div>

	  <div class="question">
    <div class="subtitle" id="Create_offline_maps_for_yourself">Create offline maps for yourself</div>
    <div class="content">
      <p>OsmAndMapCreator can also be used to create maps for yourself if you want maps that are more up-to-date then the ones you can download from OsmAnd.
      We will explain this via a Un*x/Linux/OS X like shell script and we will use the nightly generated maps from <a href="http://download.geofabrik.de/">Geofabrik</a>, a German company that sells OpenstreetMap based maps and appliances.</p>
      <div class="blocksubtitle">Shell script</div>
      <pre>
#!/bin/sh
WORK_FOLDER="/opt/OpenStreetMap"
# First download all the data
cd "$WORK_FOLDER/osm_files"
echo "Now in pwd\n"
rm *
wget -v -O Netherlands_europe.osm.pbf "http://download.geofabrik.de&#8203;/europe/netherlands-latest.osm.pbf"
#wget -v -O Luxembourg_europe.osm.pbf "http://download.geofabrik.de&#8203;/europe/luxembourg-latest.osm.pbf"
#wget -v -O Belgium_europe.osm.pbf "http://download.geofabrik.de&#8203;/europe/belgium-latest.osm.pbf"

cd $WORK_FOLDER
echo date > starttime.txt
echo "Now converting from osm.pbf to osmand obf\n"
cd "$WORK_FOLDER/OsmAndMapCreator"

java -Djava.util.logging.config.file=&#8203;logging.properties -Xms256M -Xmx2560M -cp "./OsmAndMapCreator.jar:&#8203;./lib/OsmAnd-core.jar:./lib/*.jar" net.osmand.data.&#8203;index.IndexBatchCreator ./batch.xml

cd $WORK_FOLDER
echo date > endtime.txt

echo "And finally moving the obf files from the index folder to the osmandmaps folder\n"
mv index_files/*.obf osmandmaps/
      </pre>
      <div class="blocksubtitle">Explanation</div>
      <p>The line _WORK_FOLDER=&#34;/opt/OpenStreetMap&#34;_ is a variable to set our working folder. Inside this folder we have the maps _osm_files_, _OsmAndMapCreator_, _index_files_ and _gen_files_.</p>
      <p>We move into our download folder _osm_files_ and we use the command _wget_ to download our map(s). The wget command is used with the parameter _-O &#60;name&#62;_ as we will download the latest nightly map from Geofabrik, but we will save it immediately in the nameformat OsmAnd prefers.</p>
      <p>We move into the folder _OsmAndMapCreator_ where we installed/copied the OsmAndMapCreator program. It is best to really use the program from this folder, otherwise you have to set all kind of environment variables.
        The line:
      <pre>
_java -Djava.util.logging.config.file=&#8203;logging.properties -Xms256M -Xmx2560M -cp "./OsmAndMapCreator.jar:&#8203;./lib/OsmAnd-core.jar:./lib/*.jar" net.osmand.data.&#8203;index.IndexBatchCreator ./batch.xml_
      </pre>
      runs OsmAndMapcreator on our downloaded maps. OsmAndMapCreator will process all maps it will find in the download map. this also means that it will process older maps if you still had them there.</p>
      <p>We will log the process to file (-Djava.util.logging.config.file=logging.properties), give OsmAndMapCreator a minimum amount of 256MB and a maximum amount of 2560MB (preferably more then 1024MB), and we use the setup as specified in _batch.xml_.<br/>
        Note: a 32bit Operating system can address up to approximately 1.5GB. This means that your -Xmx value can no larger be then -Xmx1720M. A larger specification is accepted without errors, but not used.
      </p>
      <p>The _batch.xml_ file can be found in the OsmAndMapCreator folder, together with the program, and contains settings for running the program.
        The line:
      <pre>
_process directory_for_osm_files=&#8203;"/opt/OpenStreetMap/osm_files" directory_for_index_files=&#8203;"/opt/OpenStreetMap/index_files" directory_for_generation=&#8203;"/opt/OpenStreetMap/gen_files"_
      </pre>
      specifies our working folders.</p>
      The next line:
      <pre>
_skipExistingIndexesAt="/..." indexPOI="true" indexRouting="true" indexMap="true"        indexTransport="true" indexAddress="true">_ 
      </pre>
      gives you options to modify parts of your map. If you don&#39;t need routing and/or addresses, you can simply skip these by setting the parameters to &#34;false&#34;. </p>
      <p>You can also use multiple batch.xml files for different purposes.</p>
      <p>The last two lines in the script move the created maps to the osmandmaps folder where we store our maps (in this case).</p>
      <p>
        The lines 
      <pre>
_echo date > starttime.txt_ 

and 

_echo date > endtime.txt_ 
      </pre>
      are not really neccessary but simply display how long the process takes.</p>
      <div class="blocksubtitle">Scheduling</div>
      <p>The shell script can be scheduled as well. You have to take notice of the Geofabrik schedule for the maps creations (calculate for your own time zone).</p>
      <p>If you want to create a new map every night, you could add a crontab line like:</p>
      <pre>_01 03 * * 7 /opt/OpenStreetMap/&#8203;osm.pbf_to_obf_convert.sh > /dev/null 2>&1_</pre>
      <p>This will start the creation of the map at 03:01 in the morning which is currently after the Geofabrik netherlands osm.pbf map has been generated (local time zone).</p>
      <div class="blocksubtitle">Performance and tuning</div>
      <p>Creating maps is a memory hungry and very I/O intensive (disk intensive) process. In other words: It takes long to very long!</p>
      <p>What can you do to improve performance:</p>
      <ul class="list">
        <li> SSD disks.</li>
        <li> Use multiple disks.</li>
        <li> Use &#34;in memory&#34; processing.</li>
      </ul>
      <div class="blocksubsubtitle">SSD disks</div>
      <p>The modern &#34;solid state&#34; disks are 2-6 times as fast as conventional hard-disks and can improve your map creation performance dramatically.</p>
      <div class="blocksubsubtitle">Multiple disks</div>
      <p>Modern operating systems can access multiple disks simultaneously. Note that this really means *multiple disks* and *NOT* multiple partitions on one disk.</p>
      <p>If you have your _process directory_for_osm_files_ on one disk and your _directory_for_generation_ on another disk you will see an nice and noticeable performance gain.</p>
      <div class="blocksubsubtitle">In memory processing</div>
      <p>You can do a great deal of the map creation not on disk but in memory. In your batch.xml one of the top lines contains:</p>
      <span class="code">&lt;process_attributes mapZooms="" renderingTypesFile="" zoomWaySmoothness="" osmDbDialect="sqlite" mapDbDialect="sqlite"/&gt;</span>
      <p>The <span class="code">osmDbDialect=&#34;sqlite&#34; mapDbDialect=&#34;sqlite&#34;</span> determines where your map generation process will take place.</p>
      <p>The line <span class="code">osmDbDialect=&#34;sqlite&#34; mapDbDialect=&#34;sqlite&#34;</span> means that it will take place on disk.</p>
      <p>If you change this to <span class="code">osmDbDialect=&#34;sqlite_in_memory&#34; mapDbDialect=&#34;sqlite_in_memory&#34; </span>the process will take place in memory.</p>
      <p>This &#34;in memory&#34; processing will speed up the map generation by 10-50% but requires a lot of memory. The 10% to 50% is dependent on the map size. Smaller maps benefit less from in memory processing than larger maps, as still the normal disk access (initial reading and final map writing) plays a major role in smaller maps, where as the processing of all the data (and their relations) in larger maps requires more &#34;calculation&#34;.</p>
      <p>In normal &#34;on disk&#34; processing a nodes.tmp.odb file is created from your .osm or .osm.pbf file. This nodes.tmp.odb file is a sqlite database file and it is about 15 to 25 times as big as the original .osm.pbf file which you downloaded from <a href="http://download.geofabrik.de/">geofabrik.de</a>.</p>
      <p>So if your original .osm.pbf file is 300MB, your nodes.tmp.odb file will be 5GB to 6GB!
        Note that smaller maps will be around the 15x factor whereas big maps (&#62;350MB) will end up in the 20x to 25X space increase.
      </p>
      <p>With &#34;in memory&#34; processing this nodes.tmp.odb file will be created in your working memory. It means that the -Xmx parameter, which we discussed in the <a href="http://code.google.com/p/osmand/wiki/CreateOfflineMapsForYourself#Explanation">Explanation</a> sections, needs to be big enough for both the nodes.tmp.odb and the normal processing that takes place in memory.</p>
      <p>You will need &#34;the size of the nodes.tmp.odb&#34; + 20-25%.</p>
      <p>It means that for a 250MB .osm.pbf, which will generate a ~4.5GB nodes.tmp.odb file, you need about 5GB heapspace which requires an -Xmx value of -Xmx5120M.</p>
      <p><b>Note</b>: a 32bit Operating system can address up to approximately 1.5GB. This means that your -Xmx value can no larger be then -Xmx1720M. A larger specification is accepted without errors, but not used. </p>
      <p>So in effect you really need a 64bit Operating system to really benefit from &#34;in memory&#34; processing.</p>
      <p>Note also that your -Xmx value should not be that big that your operating system starts swapping to disk. This will even decrease your performance below that of normal &#34;on disk&#34; processing.</p>
      <p>Finally: your source .osm.pbf file can be no larger then 600MB as this would require up to 20GB working memory. If your source file exceeds 600MB, OsmAndMapCreator will switch back to normal &#34;on disk&#34; processing. You will be notified early in the process with a warning &#34;Switching SQLITE in memory dialect to SQLITE&#34;</p>
      <p class="back_to_top"><a href="#top">Back to top</a></p>
    </div>
  </div>

  <div class="question">
    <div class="subtitle" id="Country_Polygon_Creation">Creating a country polygon</div>
    <div class="content">
      <p>This article describes how to create a poly(gon) for a missing country in geofabrik.de and how to add this poly to the map generation server of OsmAnd</p>
      <div class="blocksubtitle">Introduction</div>
      <p>OsmAnd comes with a lot of maps for a lot of countries. Most maps are created from &#34;raw data&#34; maps downloaded from <a href="http://download.geofabrik.de">geofabrik.de</a>. Geofabrik supplies these raw data maps for free to everyone and they deliver (commercial) services and products based on these maps.</p>
      <p>Geofabrik.de has the strategy to deliver maps for the countries that are requested by larger numbers of users or by their customers. This means that some maps never make it on geofabrik as there are simply not enough requests for (or none at all), like some exotic countries like the Seychelles or Burundi, etc.</p>
      <div class="blocksubtitle">Server process</div>
      <p>Because of this strategic decision of geofabrik, OsmAnd has an option to generate maps for these exotic rare countries and the tools <a href="http://download.osmand.net/latest-night-build/OsmAndMapCreator-development.zip">OsmAndMapCreator</a> and <a href="https://wiki.openstreetmap.org/wiki/Osmconvert">osmconvert</a> are used for this. For OsmAndMapCreator this is a three step process:</p>
      <ul class="list">
        <li> OsmAndMapCreator needs a polygon which surrounds the outer border of the country.</li>
        <li> OsmAndMapCreator needs the &#34;raw data map&#34; from the next level incorporating this country. For Burundi it mean that OsmAndMapCreator needs the Africa map. For Nordrhein-Westfalen it means that OsmAndMapCreator needs the Germany map.</li>
        <li> <a href="https://wiki.openstreetmap.org/wiki/Osmconvert">Osmconvert</a> will create a &#34;raw data&#34; map from the poly extracting the map data from the &#34;parent&#34; map.</li>
        <li> OsmAndMapCreator will create an OsmAnd obf map based on the intermediate &#34;raw data&#34; map generated by osmconvert.</li>
      </ul>
      <div class="blocksubtitle">Necessary actions</div>
      <p>Depending on the complexity of the (generated) polygon this complete chain of actions can take from 10 minutes to 2 hours in total.</p>
      <div class="blocksubtitle">Get the OpenStreetMap relation from Nominatim</div>
      <ul class="list">
        <li> Go to <a href="https://nominatim.openstreetmap.org/">nominatim.openstreetmap.org</a></li>
        <li> Fill in your country name</li>
        <li> Once found click on the link &#34;(details)&#34;</li>
        <li> In Details scroll down to &#34;OSM: relation &#34; and write down or copy the relation ID number.</li>
      </ul>
      <div class="blocksubtitle">Retrieve the poly(gon) from polygons.openstreetmap.fr</div>
      <div class="blocksubsubtitle">Generate the polygon</div>
      <ul class="list">
        <li> Go to <a href="http://polygons.openstreetmap.fr/">polygons.openstreetmap.fr</a></li>
        <li> Fill in (or paste) the &#34;OSM: relation &#34; ID number you retrieved from Nominatim for your desired country into the &#34;Id of relation&#34; field.</li>
        <li> This will create a default polygon, consisting of 250 to 3500 nodes (NPoints). The poly itself can be found in the &#34;poly&#34; column.</li>
        <li> In case of more then 350 nodes you will need to simplify  the polygon. The simpler the polygon, the faster the country map can be created (of course depending on the contents)</li>
      </ul>
      <div class="blocksubsubtitle">Simplify the polygon</div>
      <p>The number of Node Points (NPoints) needs to be as low as possible for the fastest possible creation of the map by OsmAndMapCreator. As mentioned: In case of more then 350 node points try to reduce them by simplifying the polygon.</p>
      <ul class="list">
        <li> In case of more then 350 nodes, try to reduce them by &#34;playing&#34; with the X variable (in my experience the others don&#39;t really matter)</li>
        <li> Sometimes you get great results (90 NPoints, 200 NPoints, 270 NPoints) and then you are done with this step. Sometimes you simply can&#39;t get below 450 NPoints or so. Then you need to apply further manual steps.</li>
        <li> Save your final polygon to file. Use the correct default name for it, like france.poly. Stick to lowercase characters.</li>
      </ul>
      </pre>
      <div class="blocksubsubtitle">Further modification and simplification of the polygon</div>
      <ul class="list">
        <li> Open JOSM (download if necessary) and open the polygon file you created (did you make a copy/backup of the original polygon that you saved?).</li>
        <li> Add a background from the &#34;Images&#34; menu and select the default &#34;OpenStreetMap (Mapnik)&#34; background.</li>
        <li> Manually remove node points where possible. *Note:* Keep the polygon as close as possible around the border. You do need some overlap but try to keep it below 2-5 kilometers. Overlap in countries will be generated twice for each country. Less overlap, means less rendering time and rendering errors. At coastlines and around islands try to keep more distance (20 kilometers). This is widely acepted and the sea is &#34;empty&#34; anyway.</li>
        <li> When you have done the best you can you can save the updated, corrected poly. As said: try to get as little node points as possible, but sometimes a country border is so complicated that you simply need more node points to describe it and to keep the polygon as close as possible around the border: so be it.</li>
        <li> *Do not upload the polygon to OSM*. JOSM will ask you to upload your work to OpenStreetMap. Don&#39;t do this for these polygons unless you know exactly what you do. Almost every country in the world is already perfectly covered in OpenStreetMap (otherwise nominatim would not be able to give you the details about the country, and polygons.openstreetmap.fr would not be able to generate the polygon based on the OSM relation id.)</li>
      </ul>
      <div class="blocksubtitle">Adding the poly(gon) to the OsmAnd server</div>
      <p>To be able to do this you must register as a user.</p>
      <p>To make the map generation possible there are two steps required:</p>
      <ul class="list">
        <li> Adding the polygon to the map data section</li>
        <li> Adding the country to the data file that is used to generate the OsmAnd obf maps.</li>
      </ul>
      <div class="blocksubsubtitle">Adding the polygon to the map data section</div>
      <ul class="list">
        <li> Go to the web address of the OsmAnd development server at <a class="externallink" href="https://github.com/osmandapp/" rel="nofollow" title="https://github.com/osmandapp/">https://github.com/osmandapp/</a></li>
        <li> Select the OsmAnd-misc section.</li>
        <li> Select &#34;fork&#34; to create your own personal repository</li>
        <li>
          <p>In your personal repository go to the folder osm-planet/polygons and select the relevant continent.</p>
          <p><b>Note</b>: The &#34;master&#34; repository is at <a href="https://github.com/osmandapp/OsmAnd-misc/.">github.com/osmandapp/OsmAnd-misc</a>. Your repository is at <a href="https://github.com/">github.com</a>&#60;your user name&#62;/OsmAnd-misc.</p>
        </li>
        <li> Create a new file and copy your poly data inside. Save the file.</li>
        <li> Create a pull request.</li>
      </ul>
      <div class="blocksubsubtitle">Add the map creation to the batch list</div>
      <ul class="list">
        <li> Go to the web address of the OsmAnd development server at <a href="https://github.com/osmandapp/">github.com/osmandapp</a></li>
        <li> Select the OsmAnd-tools section.</li>
        <li> Select &#34;fork&#34; to create your own personal repository.</li>
        <li> In your personal repository go to the folder obf-generation/regions.</li>
        <li> Select the file indexes.xml and click edit.</li>
        <li> Add your country at the relevant location and save the file.</li>
        <li> Create a pull request.</li>
      </ul>
      <div class="blocksubtitle">Creating your own personal maps from a poly</div>
      <p>You can create for example polygons from countries, counties/provinces/states, regions and cities.</p>
      <p>Say your daughter is going to Paris for a couple of days with a friend. She is not interested in navigation, walking or cycling (unless absolutely necessary), but she wants to know where she is, where to go to and where to find the interesting places (POIs). Next to that she has a small phone (low end CPU, low on memory) and small SD-card (stuffed with music). So the map needs to be as small as possible: both for storage as well as performance. You can of course download the map for france_ile-de-france.obf containing Paris, but you can also generate a &#34;custom made&#34; Paris map.</p>
      <ul class="list">
        <li> Let your daughter download OsmAnd, or even better: let her buy OsmAnd+</li>
        <li> Get the OSM relation id for Paris from Nominatim.</li>
        <li> Get the (simplified) poly for the Paris id from polygons.openstreetmap.fr</li>
        <li> download or compile <a href="https://wiki.openstreetmap.org/wiki/Osmconvert">osmconvert</a></li>
        <li> download &#34;raw data&#34; map of ile-de-france from geofabrik.de</li>
        <li>
          create raw data map of Paris from the ile-de-france map and the Paris poly like
          <pre> $ osmconvert ile-de-france.osm.pbf -B=paris.poly --out-pbf > Paris.osm.pbf</pre>
        </li>
        <li> Download the OsmAndMapCreator application from <a class="externallink" href="http://download.osmand.net/latest-night-build/" rel="nofollow" title="https://download.osmand.net/latest-night-build/">download.osmand.net/latest-night-build/</a></li>
        <li> create your OsmAnd obf map from the Paris.osm.pbf data map using OsmAndMapCreator.</li>
      </ul>
      <p class="back_to_top"><a href="#top">Back to top</a></p>
    </div>
  </div>

  <div class="question">
    <div class="subtitle" id="OsmAnd_Data_Structure">OsmAnd Data Structure</div>
    <div class="content">
      <div class="blocksubtitle">Introduction</div>
      <p>Many questions are about content of and issues with map data in the application. This topic unveils some technical details of the internal data format and data processing. It can be interesting for non-developers who are familar with the OSM data structure. </p>
      <p>All the OsmAnd data is contained in &#39;obf&#39; files. &#39;obf&#39; files have a complex structure and can consist of many parts. It is highly recommended to keep file sizes below 2 Gb. Currently obf files can have many parts consisting of multiple POI parts, multiple routing data parts, multiple Map parts, multiple Transport parts and multiple Address data parts. That list can be extended in future. To combine or split or delete some parts from the obf file use &#39;binary_inspector&#39; console tool provided with OsmAndMapCreator.</p>
      <div class="blocksubtitle">POI, Transport part</div>
      <div class="blocksubtitle">Map part</div>
      <div class="blocksubtitle">Address part</div>
      <p>Q: How does mapcreator generate its list of all places that will appear later in OsmAnd&#39;s offline address search? What objects are used in detail for that? What nodes with a place tag are included, and which are excluded?
      </p>
      <p>A: All places that are visible in OsmAnd as Cities are taken from nodes that have the tag "place" <a class="externallink" href="https://wiki.openstreetmap.org/wiki/pPlace." rel="nofollow" title="https://wiki.openstreetmap.org/wiki/Place.">https://wiki.openstreetmap.org/wiki/Place.</a> Currently city, town, suburb, village, hamlet are used.</p>
      <br/>
      <p>Q: How does mapcreator handle an area polygon that is given via a relation with boundary=administrative? How do you associate a place
        given as a node with its boundary when it is present in the OSM data?
      </p>
      <p>A: Simply saying: it currently works by name. Mapcreator tries to visit all boundaries and creates a closed (!) boundary from the relation or from separated ways and associates it with only one name. After that it tries to match *place* with *boundary name* using the *contains of* algorithm. There is also an additional check if that boundary contains the place. If there  are many boundaries of different admin_level with the same name (containing each_other like district/town/region having the same name) the highest admin_level with exact matching will be chosen.
        TODO More details should be here (about districts of the city ...) ...
      </p>
      <br/>
      <p>Q: Where is documentation describing what admin level is right to build an association to a certain place node? What countries prefer what admin level?</p>
      <p>A: Currently the association between admin_level relation and admin_centre is not used. Because only few relations provide that information.</p>
      <br/>
      <p>Q: How does mapcreator know what street belongs to what place? Are there different cases when a boundary polygon is given and when there is none?</p>
      <p>A: There are many strategies to check and they are prioritized in the following order:</p>
      <ul class="list">
        <li> The most important are places and their boundaries. In order for the street management algorithm to work correctly, the place matching boundaries should be correct. If the street belongs to many boundaries, it will be registered in all appropriate places.</li>
        <li> is_in tag (it is deprecated). So if a street has the is_in tag, it will be parsed and splitted by comma and the street will be attached to all relevant cities (by exact name matching). (TO CHECK: basic check street is in city radius?)</li>
        <li> If the street doesn&#39;t belong to any boundary (not properly closed boundaries could be an issue here), it tries to find the closest/biggest city and register the stret in that city (sometimes it registers in a town at 1 km distance and misses the closest hamlet at only 100m distance).</li>
      </ul>
      <p>The last part is very inaccurate. That&#39;s why many streets get attached to a neighbor city.</p>
      <br/>
      <p> At mapcreator&#39;s preferences you have five more settings for street suffixes, zoom, smoothness and rendering ... what are the detailed effects that you can achieve with each of them? Are those settings actually used?</p>
      <div class="blocksubtitle">Tools</div>
      <ul class="list">
        <li> OsmAndMapCreator can display what streets are associated to what city (context menu -&#62; Show address). Local obf files should be present and configured in Settings.</li>
        <li> Binary inspector tool can show a list of streets for each city. Run the tool without parameters to see the possible parameters.</li>
        <li> Currently all index files contain gen.log. Viewing the log file you can find errors in the map creation process and that could give an answer why some streets are not in the proper address index place. </li>
      </ul>
      <div class="blocksubtitle">Address Part - workflow</div>
      <p>There are these relations: </p>
      <div>city -&#62; 0..1 boundary</div>
      <div>boundary -&#62; 0..** city (used to define suburb of city)</div>
      <ol class="list">
        <li>
          <p>iterate all Osm NODEs and register as cities if the tag = PLACE is present:</p>
          <ul>
            <li> extract cities (TOWN, CITY)</li>
            <li> extract villages (anything else)</li>
          </ul>
        </li>
        <li>
          <p>iterate all RELATIONs and WAYs with type=boundary and register all boundaries:</p>
          <ul>
            <li>boundary is called Entity (way or relation) with tag &#39;boundary=administrative&#39; or with tag &#39;place=...&#39;</li>
            <li>boundary should be admin_level &#62; 4 or not have an admin_level.</li>
            <li>boundary is not always associated with a city (or state, ...). </li>
            <li>boundary can have &#39;admin_center&#39;, &#39;label&#39; member pointing to a city node</li>
            <li>boundary exactly matches by name city node and the city node falls within the boundary</li>
            <li>boundary matches start, end or substring by name city node and city node falls within the boundary</li>
          </ul>
          <p>Many boundaries can be associated with one city. Here is the order on how the most important boundary is taken and associated with the city:</p>
          <ul>
            <li>Boundary is matched by name exactly and has the tag place</li>
            <li>Boundary is matched by name exactly and has admin_level 8 &#62; 7 &#62; 6 &#62; 9 &#62; 10 &#62; 5... or nothing</li>
            <li>Boundary has admin_id matching </li>
            <li>All other cases including sorting of admin_level</li>
          </ul>
        </li>
        <li>
          <p>If the city doesn&#39;t have any assigned boundary then all boundaries that don&#39;t have cities centers and contain that city will be checked and the boundary with admin_level &#62;=7 will be assigned.</p>
        </li>
        <li>
          <p>for each boundary, make a list of cities that are inside it.</p>
        </li>
        <li>
          <p>iterate all RELATIONS and find addresses (<a href="https://wiki.openstreetmap.org/wiki/Relations/Proposed/Postal_Addresses">Postal_Addresses</a>)</p>
          <ul>
            <li>relation with &#34;address&#34; tag type, and is &#34;house&#34; or &#34;a6&#34; address_type</li>
            <li>search for associatedStreet relation and house members</li>
            <li>try to find the city for the street and city for house address.</li>
            <li>look up cities (we already must have found it in the steps before!!)</li>
            <li>if we have city and street, register it to database:</li>
            <ul>
              <li>for streetregistration, see: register street for a city</li>
                <ul>
                  <li>if street is registered, and we are processing street:</li>
                  <li>iterate over all relation members:</li>
                  <ul>
                    <li>find street -&#62; write the nodes of the street to db</li>
                    <li>find house  -&#62; write the house to to the street</li>
                  </ul>
                  <li>if street is registered, and we are processing house:</li>
                  <ul>
                    <li>find house number</li>
                    <li>find house border: if found, store: building for the street</li>
                  </ul>
                </ul>
                <p>register street (street, location of street (los), cities):</p>
                <p> Note: we might register a street to more cities = this means, the street can be in nested areas, suburb, city, hamlet, etc... For each area, we want to register the street it is in.</p>
              </li>
                <ul>
                  <li>for each city:</li>
                  <ul>
                    <li>find existing street registration within the city:</li>
                      <ul>
                        <li>if street exists:</li>
                          <ul>
                            <li>if citypart is unknown -&#62; update the existing street's city part</li>
                            <li>try to find city Part for our street, and lookup the street again</li>
                          </ul>
                        </li>
                        <li>if street does not exist: (might change after the lookup)</li>
                          <ul>
                            <li>register the street for city, city part, location, and street name</li>
                          </ul>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </ul>
              </li>
              <p>findOrRegister street</p>
              <ul>
                <li>find close cities to the street</li>
                <li>if the street is in the boundary of the city, add the city for search</li>
                <li>if no city was find, using boundary, find closest city for the street</li>
                <li>register street: for the found cities</li>
              </ul>
            </ul>
          </ul>
        </li>
        <li>
          <p>iterate all NODES, then WAYS, then RELATIONS (iterate main entity)</p>
          <ol>
            <li>
              <p>find ways - interpolations:</p>
              <ul>
                <li>for each interpolation, findOrRegister a street with the location of the interpolation</li>
                <li>for each two nodes create a building representing the interpolation</li>
              </ul>
            </li>
            <li>
              <p>for any entity, find addr:housenumber and addr:street tag (can also be the interpolation of nodes again!!!):</p>
              <ul>
                <li>skip if building for this entity already exists!</li>
                <li>findOrRegister streets for the street</li>
                <li>find the house number</li>
                <li>if housenumber contains &#39;-&#39;, try to create interpolated house number (missing latlon2?)</li>
                <li>if housenumber contains &#39;/&#39;, try to lookup second street addr:street2 --&#62; seems only for <a href="https://wiki.openstreetmap.org/wiki/RU:Key:addr">RU osm</a>:</li>
                <li>there are more variations for this: adr:housenumber2, addr2:street, addr2:housenumber etc...</li>
                <li> for each street, store the existing house</li>
              </ul>
            </li>
            <li>for way with tag - name &#38; tag - highway, but without addr:housenumber and addr:street:</li>
            <ul>
              <li>Note: this might be ways for cars, with names (highway, or so)</li>
              <li>skip if such street already exists</li>
              <li>findOrRegister the street for city</li>
              <li>write the nodes for each found street in each city</li>
            </ul>
            <li>
              <p>Each relation with &#34;postal_code&#34;, store for later use.</p>
              <p><b>Note</b>: this does not include the address:type = pc and addr:postalcode</p>
            </li>
          </ol>
        </li>
        <li>
          <p>process post codes:</p>
          <ul>
            <li>for each stored postal_code relation</li>
            <li>for each building member, update the postal_code</li>
          </ul>
        </li>
        <li>
          <p>write the index:</p>
          <ul>
            <li>split cities to: cities+towns, suburbs (suburb with is_in tag), villages (not city or town)</li>
            <li> write cities+towns using suburbs</li>
            <ul>
              <li>read street from cities+towns + apropriate suburbs for each town</li>
              <ul>
                <li>in here, there might be more streets with the same name for one city, in such case we try to find a cityPart for the street (suburb), where the street is in. There should be not more streets with same name within one city part!</li>
              </ul>
              <li>for each street</li>
              <ul>
                <li>for each building, register/create/find postcode, register the street</li>
              </ul>
            </ul>
            <li>write villages</li>
            <ul>
              <li>same as towns...</li>
            </ul>
            <li>write extracted postcodes and their streets</li>
          </ul>
        </li>
      </ol>
      <p class="back_to_top"><a href="#top">Back to top</a></p>
    </div>
  </div>

  <div class="question">
    <div class="subtitle" id="How_To_Inspect_an_obf_Binary_File">How to inspect an obf binary file</div>
    <div class="content">
      <p>If you want inspect the content of an obf file, you need to download  <a href="https://download.osmand.net/latest-night-build/OsmAndMapCreator-development.zip">OsmAndMapCreator</a>. There you can find a console application Inspector (.sh, .bat). This console application has optional parameters [-vmap, -vaddress, -vtransport] and one required parameter (input obf file). By specifying optional parameters you can trace all information from the obf file (be aware: it could be huge!).</p>
      <p>Example and step-by-step for Windows users:</p>
      <ul class="list">
        <li>have Java Runtime Environment installed</li>
        <li>download or copy any Osmand offline map from your device to your PC, place that obf file ideally in the folder with all the unzipped Mapcreator files</li>
        <li>Open Windows commandline  (e.g. by pressing Windows-key and &#34;r&#34;, then enter cmd and press return</li>
        <li>go to the folder where you have unzipped the Osmand-Mapcreator by command cd and folder name</li>
        <li>type dir to see whether you are in the right folder with file inspector.bat</li>
        <li>type inspector -h to see some help text</li>
        <li>type inspector -vaddress name_of_your_map.obf &#62;output.csv</li>
        <li>if you get a Java console error about not enough memory or similar, edit the file inspector.bat by increasing the number at parameter -Xmx512M (or similar) step-by step to a higher value</li>
        <li>try to load that (eventually very big) CSV text file into any editor or program that can load very big files, like Notepad++ ... or try an import into any spreadsheet programm like Excel or LibreOffice calc (choose TAB as field separator)</li>
        <li>use any search feature to find place names or street names</li>
      </ul>
      <p class="back_to_top"><a href="#top">Back to top</a></p>
    </div>
  </div>

  <div class="question">
    <div class="subtitle" id="OBF_routing_debugging_on_a_PC_with_OSM_map_display">OBF routing debugging on a PC with OSM map display</div>
    <div class="content">
      <div class="blocksubtitle">How-to</div>
      <ul class="list">
        <li>go to <a class="externallink" href="https://osmand.net" rel="nofollow" title="https://osmand.net">https://osmand.net</a> and download OsmandMapCreator.zip from the link on the right screen side, and unzip it, </li>
        <li>copy the obf file from your phone or tablet into that folder,</li>
        <li>start OsmandMapCreator via bat file or sh file,</li>
        <li>be sure to have an internet connection so that mapcreator can download map tiles, check all menus and settings inside mapcreator,</li>
        <li>set the working directory of mapcreator to the folder where mapcreator itself and the obf file is located.</li>
        <li>pan and zoom the map to that place where you have routing issues and that is covered by the mentioned OBF file,</li>
        <li>do right clicks in the map to set start and end points and different routing engines</li>
      </ul>
      <div class="blocksubtitle">Find the place name a street is associated with in offline OBF maps</div>
      <ul class="list">
        <li>Have a Java framework installed on your desktop computer.</li>
        <li>Download Osmand&#39;s Mapcreator, for example from <a href="https://download.osmand.net/releases/">download.osmand.net/releases</a> and unzip it to your PC.</li>
        <li>Take any map file with extensiuon OBF and put it in the same folder where all files from mapcreator are located.</li>
        <li>Start Mapcreator on your PC by clicking OsmAndMapCreator.bat or OsmAndMapCreator.sh</li>
        <li>Be sure that you have internet access on your PC, and Mapcreator&#39;s settings are that tiles are downloaded when you drag and zoom the map to your location where your issue is located.</li>
        <li>If you have zoomed to your area, do a right-click with the mouse on the map and choose &#34;show address&#34; from the popup-menu.</li>
        <li>Normally, now all the street names should be displayed from the obf file, and the place name to where each street is associated in Osmand&#39;s offline search.</li>
      </ul>
      <p class="back_to_top"><a href="#top">Back to top</a></p>
    </div>
  </div>
  <div class="question">
    <div class="subtitle" id="Using_KML_Files">Using KML Files</div>
    <div class="content">
      <p>In GoogleEarth (GE) you can add you own Placemarks on the map and collect them into a folder. From GE you can save the folder in kml format.
        When you have a different format you can use QGIS or other opensource software to convert to KML format. Maybe you can convert it directly to osm. You may use any format containing your POIs, if you are able to convert it to osm format.
      </p>
      <div class="blocksubtitle">Converting KML (or Other Formats) into osm Format</div>
      <p>To perform this task we need to use gpsbabel. It is very useful to convert waypoints, tracks, and routes between popular GPS receivers and mapping programs. The syntax is very simple, and GPS Babel has an interface to create the syntax for you:</p>
      <pre>$ gpsbabel -i kml -f my_places.kml -o osm,tagnd="tourism:museum",&#8203;created_by -F my_places.osm</pre>
      <p>The generated file is like this:</p>
      <pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;
&lt;osm version='0.5' generator='GPSBabel-1.4.0'&gt;
  &lt;node id='-1' visible='true' lat='41.890121' lon='12.492265'&gt;
    &lt;tag k='name' v='place01'/&gt;
    &lt;tag k='note' v='place01'/&gt;
    &lt;tag k='tourism' v='museum'/&gt;
  &lt;/node&gt;
&lt;node id='-2' visible='true' lat='41.892241' lon='12.489031'&gt;>
    &lt;tag k='name' v='place02'/&gt;
    &lt;tag k='note' v='place02'/&gt;
    &lt;tag k='tourism' v='museum'/&gt;
  &lt;/node&gt;
&lt;/osm&gt;
      </pre>
      <p>All points inside the kml file are converted into osm points, assigning them some properties like tourism category and museum type. The created_by= option with missing value means that the properties will be ignored. If your poi belongs to different categories, I suggest you create multiple osm files and create OsmAnd odf files and merge them together later with OsmAndMapCreator, or create multiple obf files. </p>
      <div class="blocksubtitle">Converting OSM Format into OBF Format</div>
      <p>Now you are ready to perform the final step. The conversion will be done using OsmAndMapCreator. Download, unzip and run this program.</p>
      <ul class="list">
        <li> Deselect all choices except Build POI Index as shown:</li>
        <li> Select the work dir (File/Specify working directory&hellip;)</li>
        <li> Load my_places.osm (File/Select osm file&hellip;)</li>
      </ul>
      <p>If all is right you&#39;ll find My_places.obf into your workdir folder. Simply upload this file into your OsmAnd phone folder and you have done. </p>
      <p>Good luck!!!</p>
      <p class="back_to_top"><a href="#top">Back to top</a></p>
    </div>
  </div>

  <div class="question">
    <div class="subtitle" id="How_to_produce_customized_vector_data">How to produce customized vector data</div>
    <div class="content">
      <p>It is possible to create a customized obf file with specific (own)  vector data (hiking paths, speed cams, transport routes debug way info), and adjust the rendere to display it.</p>
      <p>OsmAndMapCreator can process only OSM files (osm-xml, bz2, pbf). However the set of tags can be custom. To specify what tags/values need to be indexed by Creator please download and change <a href="https://github.com/osmandapp/OsmAnd-resources/blob/master/obf_creation/rendering_types.xml">this</a> file. OsmAndMapCreator has an option to use custom rendering_types.xml in the settings. Once file is created you can double check that data is present by utility binaryInspector with &#39;-vmap&#39; argument. This utility is packaged with OsmAndMapCreator. </p>
      <p>Once the .obf file is ready you can create custom rendering file to display missing attributes. There is a <a href="https://github.com/osmandapp/OsmAnd-resources/blob/master/rendering_styles/default.render.xml">default rendering style</a> which contains all information about rendering. It is good to have a look at it but it is very hard to open/edit it and understand. More convenient way to create your own rendering style is to create style that depends (inherits) default style. A good example of custom rendering style you can find <a href="https://github.com/osmandapp/OsmAnd-resources/blob/master/rendering_styles/Winter-and-ski.render.xml.">here</a>.</p>
      <p>Currently OsmAndMapCreator doesn&#39;t support relation tagging. So you need to manually copy all tags from relations (like route color) to way tags by script.</p>
      <p class="back_to_top"><a href="#top">Back to top</a></p>
    </div>
  </div>

  <div class="question">
    <div class="subtitle" id="OsmAnd_SQLite_Spec">Specification of OsmAnd's SQLite format</div>
    <div class="content">
      <p>The SQLIte format used in OsmAnd is based on the "BigPlanet" SQLite as supported by MOBAC. In OsmAnd we add a number of tables extending the format:</p>

    <table style="width:100%">
      <tr>
        <th>Table</th>
        <th>Column</th>
        <th>Spec and Purpose</th>
      </tr>
      <tr>
        <td>"info"</td>
        <td>"url"</td>
        <td>String. URL template to download tiles with zoom - {1}, x - {2} , y - {3}, server name - {rnd}</td>
      </tr>
      <tr>
        <td></td>
        <td>"randoms"</td>
        <td>String. The names of the mirrors of server. Comma-separated. One of these values will randomly replace the placeholder {rdn} in "url" field.</td>
      </tr>
      <tr>
        <td></td>
        <td>"referer"</td>
        <td>String. HTTP Referer. As used for downloading.</td>
      </tr>
      <tr>
        <td></td>
        <td>"minzoom"</td>
        <td>Integer. Min zoom level. Respective integer. (Also inverted in case of BigPlanet).</td>
      </tr>
      <tr>
        <td></td>
        <td>"maxzoom"</td>
        <td>Integer. Max zoom level. Respective integer. (Also inverted in case of BigPlanet).</td>
      </tr>
      <tr>
        <td></td>
        <td>"ellipsoid"</td>
        <td>Integer 0 or 1. 1 for Elliptic Mercator (Yandex tiles). 0 for regular Spheric Web Mercator (OSM, Google maps)</td>
      </tr>
      <tr>
        <td></td>
        <td>"inverted_y"</td>
        <td>Integer 0 or 1. 1 for inverted Y tile number (Nakarte.me tiles).</td>
      </tr>
      <tr>
        <td></td>
        <td>"timeSupported"</td>
        <td>Bool "yes" or "no". A tiles table with a "time" column indicates when each tile was retrieved.</td>
      </tr>
      <tr>
        <td></td>
        <td>"expireminutes"</td>
        <td>Integer. Specifies if tiles shall expire after the given number of minutes. They would still be displayed, but also re-downloaded.</td>
      </tr>
      <tr>
        <td></td>
        <td>"tilenumbering"</td>
        <td>String "" or "BigPlanet". If "BigPlanet", zoom will be inverted and calculated as z = 17 - zoom.</td>
      </tr>
      <tr>
        <td>"tiles"</td>
        <td>"x", "y", "z"</td>
        <td>Integer. Indicates tile Mercator coordinates. Note that zoom could be inverted for the BigPlanet case.</td>
      </tr>
      <tr>
        <td></td>
        <td>"image"</td>
        <td>Blob of image bytes.</td>
      </tr>
      <tr>
        <td></td>
        <td>"time"</td>
        <td>Integer. Time stamp when image was downloaded.</td>
      </tr>
    </table>

		<p>The class supporting this is SQLiteTileSource at or near <a href="https://github.com/osmandapp/Osmand/blob/master/OsmAnd/src/net/osmand/plus/SQLiteTileSource.java#L33">https://github.com/osmandapp/Osmand/blob/master/OsmAnd/src/net/osmand/plus/SQLiteTileSource.java#L33</a></p>
      <p class="back_to_top"><a href="#top">Back to top</a></p>
    </div>
  </div>

    <div class="question">
    <div class="subtitle" id="OsmAnd_Metainfo_Spec">Specification of OsmAnd's Metainfo format</div>
    <div class="content">
      <p>The Metainfo format used in OsmAnd to store the tile layers preferences. In OsmAnd we add a number of tables extending the format:</p>

    <table style="width:100%">
      <tr>
        <th>Field</th>
        <th>Spec and Purpose</th>
      </tr>
      <tr>
        <td>"[url_template]"</td>
        <td>String. URL template to download tiles with zoom - {1}, x - {2} , y - {3}, server name - {rnd}</td>
      </tr>
      <tr>
        <td>"[randoms]"</td>
        <td>String. The names of the mirrors of server. Comma-separated. One of these values will randomly replace the placeholder {rdn} in "url" field.</td>
      </tr>
      <tr>
        <td>"[minzoom]"</td>
        <td>Integer. Min zoom level. In regular format (OSM, Google maps).</td>
      </tr>
      <tr>
        <td>"[maxzoom]"</td>
        <td>Integer. Max zoom level. In regular format (OSM, Google maps).</td>
      </tr>
      <tr>
        <td>"[ellipsoid]"</td>
        <td>Bool "true" or "false". True for Elliptic Mercator (Yandex tiles). False for regular Spheric Web Mercator (OSM, Google maps)</td>
      </tr>
      <tr>
        <td>"[inverted_y]"</td>
        <td>Bool "true" or "false". True for inverted Y tile number (Nakarte.me tiles).</td>
      </tr>
      <tr>
        <td>"[tile_size]"</td>
        <td>Integer 256 or 512. Side size of downloading tile in px.</td>
      </tr>
      <tr>
        <td>"[img_density]"</td>
        <td>Integer. Tile image density.</td>
      </tr>
      <tr>
        <td>"[avg_img_size]"</td>
        <td>Integer.Average tile image size. </td>
      </tr>
      <tr>
        <td>"[expiration_time_minutes]"</td>
        <td>Integer. Specifies if tiles shall expire after the given number of minutes. They would still be displayed, but also re-downloaded.</td>
      </tr>    
    </table>

    <p>The class supporting this tile sourcw is at or near <a href="https://github.com/osmandapp/Osmand/blob/master/OsmAnd-java/src/main/java/net/osmand/map/TileSourceManager.java#L28">https://github.com/osmandapp/Osmand/blob/master/OsmAnd-java/src/main/java/net/osmand/map/TileSourceManager.java#L28</a></p>
      <p class="back_to_top"><a href="#top">Back to top</a></p>
    </div>
  </div>

  <h3 class="help"><a href="https://osmand.net/help/docs/Custom_Rendering_How-To.htm">Custom_Rendering_How-To.htm</a></h3>

</div>
